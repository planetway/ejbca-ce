<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<ui:remove>
	<!--
    /*************************************************************************
 	 *                                                                       *
 	 *  EJBCA - Proprietary Modules: Enterprise Certificate Authority        *
 	 *                                                                       *
 	 *  Copyright (c), PrimeKey Solutions AB. All rights reserved.           *
 	 *  The use of the Proprietary Modules are subject to specific           *
 	 *  commercial license terms.                                            *
 	 *                                                                       *
 	 *************************************************************************/
     -->
</ui:remove>

<ui:composition template="/WEB-INF/include/template.xhtml">
    <ui:param name="resourceBean" value="#{systemConfigMBean}" />
	<ui:define name="content">

	<h1>
        <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_EDITKEY}: " rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.editMode}"/>
        <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_VIEWKEY}: " rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}"/>
        <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_ADDKEY}: " rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.addMode}"/>
        <h:outputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.oauthKeyBeingEdited.label}"/>
    </h1>
    <h:form id="editOAuthKeyForm" enctype="multipart/form-data">
        <h:panelGrid columns="2">
            <h:outputLink id="goBack" value="systemconfiguration.xhtml">
                <h:outputText value="#{web.text.BACK}"/>
            </h:outputLink>
            <h:panelGroup id="placeholder1" rendered="#{!systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}"/>
            <h:commandButton action="#{systemConfigMBean.oauthKeyManager.toggleCurrentAliasEditMode}" value="#{web.text.CRYPTOTOKEN_NAV_EDIT}"
                             rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode and systemConfigMBean.allowedToEditOauthKeys}"/>

            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_LABEL}"/>
            <h:inputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.label}" size="46" id="label"
                         disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}">
                <f:converter converterId="trimConverter"/>
            </h:inputText>

            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_URL}"/>
            <h:inputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.url}" size="46" id="keyUrl"
                         disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}">
                <f:converter converterId="trimConverter"/>
            </h:inputText>

            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_SKEWLIMIT}"/>
            <h:inputText id="editedProviderSkewLimit"
                required="true"
                disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}"
                value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.skewLimit}"
                title="#{web.text.FORMAT_MILLISECONDS}"
                size="10"/>
            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_REALM}"/>
            <h:inputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.realm}" size="46" id="realm"
                         disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}">
                <f:converter converterId="trimConverter"/>
            </h:inputText>
            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_CLIENT}"/>
            <h:inputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.client}" size="46" id="client"
                         disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}">
                <f:converter converterId="trimConverter"/>
            </h:inputText>

        </h:panelGrid>
        <h:dataTable value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.publicKeys}"
            var="key"
            styleClass="grid oauthkeyTable" style="margin: 5px;">
            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_KEYIDENTIFIER}"/>
                </f:facet>
                <h:outputText value="#{key.keyIdentifier}"
                              title="#{web.text.OAUTHKEYCONFIGURATION_KEYIDENTIFIER}"/>
            </h:column>
            <h:column>
                <f:facet name="header">
                    <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_PUBLICKEY}"/>
                </f:facet>
                <h:outputText value="#{key.keyFingerprint}"
                              title="#{web.text.OAUTHKEYCONFIGURATION_PUBLICKEY}"
                              styleClass="monospace"/>
            </h:column>
            <h:column rendered="#{!systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode and systemConfigMBean.allowedToEditOauthKeys}">
                <f:facet name="header" >
                    <h:outputText value="#{web.text.ACTIONS}"/>
                </f:facet>
                <h:commandButton action="#{systemConfigMBean.oauthKeyManager.removePublicKey(key)}"
                                 value="#{web.text.REMOVE}"
                                 id="removePublicKeyButton"/>
            </h:column>
        </h:dataTable>
        <h:panelGrid columns="2"
                     rendered="#{!systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode and systemConfigMBean.allowedToEditOauthKeys}">
            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_REPLACE_PUBLICKEY} "
                          rendered="#{!systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}"/>
            <t:inputFileUpload id="editedOAuthKeyFile"
                               rendered="#{!systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode and systemConfigMBean.allowedToEditOauthKeys}"
                               value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.publicKeyFile}"
                               title="#{web.text.OAUTHKEYCONFIGURATION_NEW_PUBLICKEYFILE}"/>

            <h:outputText value="#{web.text.OAUTHKEYCONFIGURATION_KEYIDENTIFIER}"/>
            <h:inputText value="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.keyIdentifier}" size="46" id="keyId"
                         disabled="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.viewMode}">
                <f:converter converterId="trimConverter"/>
            </h:inputText>
            <h:commandButton id="addPublicKey" value="Upload public key"
                             action="#{systemConfigMBean.oauthKeyManager.addPublicKey}"/>

        </h:panelGrid>

        <h:commandButton id="saveOAuthKeyEdit" action="#{systemConfigMBean.oauthKeyManager.saveOauthKeyBeingEdited}" value="#{web.text.SAVE}"
                         rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.editMode and systemConfigMBean.allowedToEditOauthKeys}"/>
        <h:commandButton id="addOauthKey" value="#{web.text.ADD}"
                         action="#{systemConfigMBean.oauthKeyManager.addOauthKey}"
                         rendered="#{systemConfigMBean.oauthKeyManager.oauthKeyEditor.addMode and systemConfigMBean.allowedToEditOauthKeys}"/>
    </h:form>
	</ui:define>
	</ui:composition>
</html>
